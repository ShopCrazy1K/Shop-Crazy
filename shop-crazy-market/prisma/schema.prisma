generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "postgresql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

//////////////////////////////////////
// ENUMS
//////////////////////////////////////

enum RefundType {
  CREDIT
  CASH
}

enum RefundStatus {
  NONE
  REQUESTED
  APPROVED
  PROCESSING
  COMPLETED
  REJECTED
}

//////////////////////////////////////
// USER
//////////////////////////////////////

model User {
  id                     String  @id @default(cuid())
  email                  String  @unique
  username               String?
  passwordHash           String? // Hashed password (optional for OAuth users)
  role                   String  @default("USER") // "USER" or "ADMIN"
  adsEnabled             Boolean @default(false) // seller opt-in for ad fee
  about                  String? // About section for seller profile (like Etsy)
  avatar                 String? // Profile picture/avatar URL
  coverPhoto             String? // Cover photo URL for profile page (like Etsy)
  tutorialCompleted      Boolean @default(false) // Track if user completed onboarding tutorial
  // Shop Policies
  shopAnnouncement       String? // Shop announcements
  shopAbout              String? // About your shop
  shippingPolicy         String? // Shipping policy
  returnsPolicy          String? // Returns and exchanges policy
  cancellationsPolicy    String? // Cancellations policy
  faqs                   String? // FAQs (JSON array of {question, answer})
  digitalDownloadsPolicy String? // Digital downloads policy
  paymentMethods         String? // Payment methods accepted

  // Store Credit
  storeCredit Int @default(0) // Stored in cents (500 = $5.00)

  // Referral System
  referralCode   String? @unique // Unique referral code for this user
  referredBy     String? // User ID who referred this user
  referredByUser User?   @relation("Referrals", fields: [referredBy], references: [id], onDelete: Restrict, onUpdate: Restrict)
  referrals      User[]  @relation("Referrals") // Users referred by this user

  // Etsy-style relationships
  shop             Shop?
  buyerOrders      Order[]             @relation("BuyerOrders") // Orders as a buyer
  reviews          Review[]
  reviewsReceived  Review[]            @relation("ReceivedReviews") // Reviews received as a seller
  favorites        Favorite[]
  messagesSent     Message[]           @relation("SentMessages")
  messagesRecv     Message[]           @relation("ReceivedMessages")
  listings         Listing[]
  sellerOrders     Order[]             @relation("SellerOrders")
  notifications    Notification[] // Notifications received by this user
  followers        Follow[]            @relation("Followers") // Users who follow this user
  following        Follow[]            @relation("Following") // Users this user follows
  creditLedger     CreditLedger[] // Store credit ledger entries
  sellerCredits    CreditLedger[]      @relation("SellerCredits") // Credits funded by this seller
  savedSearches    SavedSearch[] // Saved searches
  recentlyViewed   RecentlyViewed[] // Recently viewed listings
  comparisons      ProductComparison[] // Products being compared
  listingViews     ListingView[] // Views on listings (for analytics)
  priceAlerts      PriceAlert[] // Price alerts
  listingFavorites ListingFavorite[] // Favorite listings
  collections      Collection[] // User collections/wishlists
  counterNotices   CounterNotice[] // DMCA counter-notices filed by this seller

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

//////////////////////////////////////
// SHOP (SELLER STOREFRONT)
//////////////////////////////////////

model Shop {
  id          String  @id @default(uuid())
  name        String  @unique
  description String?
  bannerUrl   String?
  logoUrl     String?

  ownerId String @unique
  owner   User   @relation(fields: [ownerId], references: [id])

  stripeAccountId    String?
  hasAdvertising     Boolean   @default(false)
  lastListingFeeDate DateTime?

  products            Product[]
  reviews             Review[]
  listingFees         ListingFee[]
  feeTransactions     FeeTransaction[]
  platformConnections PlatformConnection[]
  sellerStrikes       SellerStrike[]
  promotions          Deal[] // Shop-wide promotions and discount codes

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

//////////////////////////////////////
// COPYRIGHT PROTECTION
//////////////////////////////////////

model CopyrightReport {
  id            String   @id @default(uuid())
  productId     String? // Legacy: for old Product-based reports
  product       Product? @relation(fields: [productId], references: [id])
  listingId     String? // New: for Listing-based reports
  listing       Listing? @relation(fields: [listingId], references: [id])
  reporterEmail String
  reason        String
  status        String   @default("PENDING") // "PENDING", "APPROVED", "REJECTED", "RESOLVED"
  adminNotes    String?
  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([productId])
  @@index([listingId])
  @@index([status])
  @@index([reporterEmail])
}

//////////////////////////////////////
// DMCA & IP PROTECTION SYSTEM
//////////////////////////////////////

model DMCAComplaint {
  id        String  @id @default(uuid())
  listingId String
  listing   Listing @relation("DMCAComplaints", fields: [listingId], references: [id])

  // Complainant Information (Required by DMCA)
  complainantName    String
  complainantEmail   String
  complainantPhone   String?
  complainantAddress String // Physical address required by DMCA

  // Copyright Owner Information
  copyrightOwnerName  String
  copyrightOwnerEmail String?

  // Infringement Details
  copyrightedWork        String // Description of copyrighted work
  infringingWork         String // Description of infringing material
  locationOfInfringement String // URL or description of where infringement appears

  // Good Faith Statement (Required by DMCA)
  goodFaithStatement String // Statement that complaint is in good faith

  // Signature
  electronicSignature String // Name of person authorized to act

  // Status & Resolution
  status     String    @default("PENDING") // "PENDING", "VALID", "INVALID", "RESOLVED", "COUNTER_NOTICED"
  adminNotes String?
  reviewedBy String? // Admin user ID
  reviewedAt DateTime?

  // Auto-flag info
  autoFlagged  Boolean  @default(false)
  flaggedWords String[] @default([])

  // Counter-notice
  counterNotice CounterNotice?
  
  // Strikes linked to this complaint
  strikes      SellerStrike[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([listingId])
  @@index([status])
  @@index([complainantEmail])
  @@index([createdAt])
}

model CounterNotice {
  id          String        @id @default(uuid())
  complaintId String        @unique
  complaint   DMCAComplaint @relation(fields: [complaintId], references: [id])
  listingId   String
  listing     Listing       @relation("CounterNotices", fields: [listingId], references: [id])
  sellerId    String
  seller      User          @relation(fields: [sellerId], references: [id])

  // Respondent Information (Required by DMCA)
  respondentName    String
  respondentEmail   String
  respondentPhone   String?
  respondentAddress String // Physical address required by DMCA

  // Statement
  statement String // Statement that material was removed/misidentified

  // Good Faith Statement
  goodFaithStatement String // Statement that counter-notice is in good faith

  // Consent to Jurisdiction
  consentToJurisdiction String // Consent to jurisdiction of federal court

  // Signature
  electronicSignature String // Name of person authorized to act

  // Status & Resolution
  status     String    @default("PENDING") // "PENDING", "APPROVED", "REJECTED"
  adminNotes String?
  reviewedBy String? // Admin user ID
  reviewedAt DateTime?

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([complaintId])
  @@index([listingId])
  @@index([sellerId])
  @@index([status])
}

model BannedWord {
  id        String   @id @default(uuid())
  word      String   @unique // The banned word/phrase
  category  String? // Optional: "brand", "celebrity", "movie", "logo", etc.
  severity  String   @default("WARNING") // "WARNING", "AUTO_FLAG", "AUTO_HIDE"
  createdAt DateTime @default(now())
  createdBy String? // Admin user ID who added it

  @@index([word])
  @@index([category])
}

model SellerStrike {
  id                String    @id @default(uuid())
  sellerId          String
  shop              Shop      @relation(fields: [sellerId], references: [id])
  reason            String
  reportId          String? // Link to CopyrightReport if applicable
  complaintId       String? // Link to DMCAComplaint if applicable
  complaint         DMCAComplaint? @relation(fields: [complaintId], references: [id])
  strikeType        String    @default("COPYRIGHT") // "COPYRIGHT", "TRADEMARK", "OTHER"
  status            String    @default("ACTIVE") // "ACTIVE", "APPEALED", "OVERTURNED", "UPHELD"
  appealReason      String? // Seller's appeal explanation
  appealSubmittedAt DateTime?
  adminNotes        String?
  createdAt         DateTime  @default(now())

  @@index([sellerId])
  @@index([status])
  @@index([strikeType])
}

//////////////////////////////////////
// FOLLOW (USER FOLLOWING)
//////////////////////////////////////

model Follow {
  id          String   @id @default(uuid())
  followerId  String // User who is following
  follower    User     @relation("Following", fields: [followerId], references: [id])
  followingId String // User being followed
  following   User     @relation("Followers", fields: [followingId], references: [id])
  createdAt   DateTime @default(now())

  @@unique([followerId, followingId])
  @@index([followerId])
  @@index([followingId])
}

//////////////////////////////////////
// PRODUCT
//////////////////////////////////////

model Product {
  id          String @id @default(uuid())
  title       String
  description String
  price       Int
  quantity    Int    @default(1)
  images      String // JSON array stored as string: ["url1", "url2"]

  zone      String // "SHOP_4_US", "GAME_ZONE", "FRESH_OUT_WORLD"
  category  String? // Category slug: "shop-4-us", "game-zone", etc.
  type      String  @default("PHYSICAL") // "PHYSICAL" or "DIGITAL"
  condition String // "NEW" or "USED"
  hidden    Boolean @default(false) // Auto-hide products with multiple reports

  shopId String
  shop   Shop   @relation(fields: [shopId], references: [id])

  // Platform integration
  platformConnectionId String?
  platformConnection   PlatformConnection? @relation(fields: [platformConnectionId], references: [id])
  externalProductId    String? // ID from Shopify/Printify
  syncEnabled          Boolean             @default(false)
  lastSyncedAt         DateTime?

  reviews          Review[]
  orderItems       OrderItem[]
  favorites        Favorite[]
  listingFees      ListingFee[]
  copyrightReports CopyrightReport[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

//////////////////////////////////////
// LISTING
//////////////////////////////////////

model Listing {
  id       String @id @default(cuid())
  sellerId String
  seller   User   @relation(fields: [sellerId], references: [id])

  title       String
  description String
  slug        String  @unique
  priceCents  Int     @default(0)
  currency    String  @default("usd")
  category    String? // Category slug: "shop-4-us", "game-zone", etc.

  // Digital files / assets (store URLs or storage keys)
  digitalFiles     String[] @default([])
  images           String[] @default([])
  thumbnailIndices Int[]    @default([]) // Indices of images to show as thumbnails (max 4)
  thumbnails       String[] @default([]) // Multiple thumbnail images (Etsy-style)

  // SEO & Discovery
  tags            String[] @default([]) // Product tags/keywords for search
  searchKeywords  String? // Additional search keywords
  metaDescription String? // SEO meta description

  // Product Attributes
  sku             String? // Product SKU/code
  brand           String? // Brand/Manufacturer name
  materials       String? // Materials used
  dimensions      String? // Product dimensions (e.g., "10x5x3 inches")
  weight          String? // Product weight (e.g., "1.5 lbs")
  color           String? // Primary color
  countryOfOrigin String? // Country where product is made/shipped from

  // Shipping Information (for physical products)
  shippingCostCents Int? // Shipping cost in cents
  processingTime    String? // Processing time (e.g., "1-3 business days")
  shippingMethods   String[] @default([]) // Available shipping methods

  // Policies & Information
  returnPolicy     String? // Return policy description
  returnWindowDays Int? // Return window in days
  warrantyInfo     String? // Warranty information
  careInstructions String? // Care/usage instructions

  // Variants (stored as JSON for flexibility)
  variants Json? // Product variants (size, color, etc.) with prices

  // Draft status
  isDraft Boolean @default(false) // Save as draft

  // Copyright/IP Protection
  copyrightStatus String          @default("CLEAR") // "CLEAR", "FLAGGED", "HIDDEN", "DISABLED", "DMCA_COMPLAINT"
  flaggedWords    String[]        @default([]) // Words that triggered auto-flag
  flaggedAt       DateTime?
  flaggedReason   String? // Reason for flagging
  dmcaComplaints  DMCAComplaint[] @relation("DMCAComplaints")
  counterNotices  CounterNotice[] @relation("CounterNotices")

  // Listing subscription fee state ($0.20/mo)
  isActive              Boolean @default(false)
  feeSubscriptionId     String?
  feeSubscriptionStatus String? // active, past_due, canceled...
  feeCustomerId         String?

  // Orders for this listing
  orders           Order[]
  deals            Deal[] // Promotions and discounts
  copyrightReports CopyrightReport[] // Copyright reports for this listing
  recentlyViewed   RecentlyViewed[] // Users who viewed this
  comparisons      ProductComparison[] // Users comparing this product
  views            ListingView[] // View tracking for analytics
  priceAlerts      PriceAlert[] // Users with price alerts
  favorites        ListingFavorite[] // Users who favorited this

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

//////////////////////////////////////
// ORDER
//////////////////////////////////////

model Order {
  id String @id @default(uuid())

  buyerEmail String?
  sellerId   String
  seller     User    @relation("SellerOrders", fields: [sellerId], references: [id])

  listingId String
  listing   Listing @relation(fields: [listingId], references: [id])

  currency String @default("usd")

  // Inputs
  itemsSubtotalCents Int
  shippingCents      Int     @default(0)
  giftWrapCents      Int     @default(0)
  taxCents           Int     @default(0)
  discountCents      Int     @default(0) // Discount from promo code or deal
  promoCode          String? // Promo code used (if any)

  // Computed
  orderSubtotalCents Int // items + shipping + gift wrap
  orderTotalCents    Int // orderSubtotal + tax

  // Store Credit
  storeCreditUsedCents Int @default(0) // Amount of store credit used for this order

  // Fees (computed server-side)
  platformFeeCents   Int @default(0) // 5% of orderSubtotal
  adFeeCents         Int @default(0) // 15% of orderSubtotal if seller ads enabled
  processingFeeCents Int @default(0) // your surcharge (rate + fixed)

  feesTotalCents    Int @default(0)
  sellerPayoutCents Int @default(0)

  // Stripe
  stripeSessionId     String? @unique
  stripePaymentIntent String?

  paymentStatus String @default("pending") // pending, paid, failed, refunded

  // Refund fields
  refundType   RefundType?
  refundStatus RefundStatus @default(NONE)
  refundAmount Int          @default(0) // cents
  refundReason String?
  refundedAt   DateTime?

  // Shipping & Tracking
  shippingStatus  String? // processing, shipped, delivered
  trackingCarrier String? // USPS, UPS, FedEx, DHL, Other
  trackingNumber  String?
  shippedAt       DateTime?

  // For audit/debug
  processingRule   String? // e.g. "US_2%_20c"
  adsEnabledAtSale Boolean @default(false)

  // Legacy relations for backward compatibility with shop-based orders
  userId          String?
  user            User?            @relation("BuyerOrders", fields: [userId], references: [id])
  items           OrderItem[]
  feeTransactions FeeTransaction[]
  reviews         Review[] // Reviews for this order

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model OrderItem {
  id        String @id @default(uuid())
  orderId   String
  productId String
  quantity  Int
  price     Int

  order   Order   @relation(fields: [orderId], references: [id])
  product Product @relation(fields: [productId], references: [id])
}

//////////////////////////////////////
// REVIEW (PRODUCT + SHOP)
//////////////////////////////////////

model Review {
  id      String   @id @default(uuid())
  rating  Int
  comment String?
  photos  String[] // Array of photo URLs for review

  userId String // Reviewer (who wrote the review)
  user   User   @relation(fields: [userId], references: [id])

  sellerId String? // Seller being reviewed (for shop/user reviews)
  seller   User?   @relation("ReceivedReviews", fields: [sellerId], references: [id])

  productId String?
  product   Product? @relation(fields: [productId], references: [id])

  shopId String?
  shop   Shop?   @relation(fields: [shopId], references: [id])

  orderId String? // Link to order if review is from a purchase
  order   Order?  @relation(fields: [orderId], references: [id])

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

//////////////////////////////////////
// FAVORITES (LIKE ETSY)
//////////////////////////////////////

model Favorite {
  id String @id @default(uuid())

  userId String
  user   User   @relation(fields: [userId], references: [id])

  productId String
  product   Product @relation(fields: [productId], references: [id])

  createdAt DateTime @default(now())

  @@unique([userId, productId])
}

//////////////////////////////////////
// MESSAGING (BUYER â†” SELLER)
//////////////////////////////////////

model Message {
  id      String @id @default(uuid())
  content String

  senderId   String
  receiverId String

  sender   User @relation("SentMessages", fields: [senderId], references: [id])
  receiver User @relation("ReceivedMessages", fields: [receiverId], references: [id])

  createdAt DateTime @default(now())
}

//////////////////////////////////////
// NOTIFICATION
//////////////////////////////////////

model Notification {
  id     String @id @default(uuid())
  userId String // User who receives the notification
  user   User   @relation(fields: [userId], references: [id])

  type    String // "message", "order", "review", etc.
  title   String
  message String
  link    String? // Optional link to related page (e.g., /messages/userId, /orders/orderId)

  read   Boolean   @default(false)
  readAt DateTime?

  createdAt DateTime @default(now())

  @@index([userId])
  @@index([read])
  @@index([createdAt])
}

//////////////////////////////////////
// LISTING FEES
//////////////////////////////////////

model ListingFee {
  id              String    @id @default(uuid())
  shopId          String
  shop            Shop      @relation(fields: [shopId], references: [id])
  productId       String
  product         Product   @relation(fields: [productId], references: [id])
  amount          Int
  month           Int
  year            Int
  paid            Boolean   @default(false)
  paidAt          DateTime?
  stripeInvoiceId String?

  createdAt DateTime @default(now())

  @@unique([shopId, productId, month, year])
  @@index([shopId, month, year])
}

//////////////////////////////////////
// FEE TRANSACTIONS
//////////////////////////////////////

model FeeTransaction {
  id      String  @id @default(uuid())
  orderId String?
  order   Order?  @relation(fields: [orderId], references: [id])
  shopId  String?
  shop    Shop?   @relation(fields: [shopId], references: [id])

  type        String
  amount      Int
  description String?

  createdAt DateTime @default(now())

  @@index([shopId])
  @@index([orderId])
  @@index([type])
}

//////////////////////////////////////
// PLATFORM INTEGRATIONS
//////////////////////////////////////

model PlatformConnection {
  id     String @id @default(uuid())
  shopId String
  shop   Shop   @relation(fields: [shopId], references: [id])

  platform    String // "SHOPIFY" or "PRINTIFY"
  accessToken String // Encrypted OAuth token
  storeName   String? // Shopify store name or Printify shop name
  storeUrl    String? // Store URL

  isActive    Boolean @default(true)
  syncEnabled Boolean @default(false)

  products Product[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([shopId, platform])
  @@index([shopId])
  @@index([platform])
}

//////////////////////////////////////
// DEALS & PROMOTIONS (ETSY-STYLE)
//////////////////////////////////////

model Deal {
  id String @id @default(cuid())

  listingId String?
  listing   Listing? @relation(fields: [listingId], references: [id])

  shopId String? // For shop-wide promotions
  shop   Shop?   @relation(fields: [shopId], references: [id])

  // Deal details
  title         String // e.g., "20% Off Sale", "Flash Sale"
  description   String?
  discountType  String // "PERCENTAGE" or "FIXED_AMOUNT"
  discountValue Int // e.g., 20 for 20% or 500 for $5.00
  promoCode     String? @unique // Optional promo code (e.g., "SAVE20")

  // Promotion type
  promotionType String @default("LISTING") // "LISTING", "SHOP_WIDE", "ABANDONED_CART", "CUSTOM_CODE"

  // Timing
  startsAt DateTime
  endsAt   DateTime
  isActive Boolean  @default(true)

  // Usage limits
  maxUses          Int? // Maximum number of times this deal can be used (null = unlimited)
  currentUses      Int  @default(0) // Track how many times it's been used
  minPurchaseCents Int? // Minimum purchase amount to use this deal

  // Abandoned cart specific
  abandonedCartDelayHours Int? // Hours to wait before sending abandoned cart offer (e.g., 24)
  abandonedCartEmailSent  Boolean @default(false) // Track if email was sent

  // Display
  badgeText  String? // e.g., "Limited Time", "Flash Sale"
  badgeColor String? // e.g., "red", "green", "purple"

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([listingId])
  @@index([shopId])
  @@index([isActive, endsAt])
  @@index([promoCode])
  @@index([startsAt, endsAt])
  @@index([promotionType])
}

//////////////////////////////////////
// CREDIT LEDGER
//////////////////////////////////////

model CreditLedger {
  id     String @id @default(cuid())
  userId String
  user   User   @relation(fields: [userId], references: [id])

  sellerId String? // If seller-funded, track which seller
  seller   User?   @relation("SellerCredits", fields: [sellerId], references: [id])

  funder String // "PLATFORM" or "SELLER"
  reason String // e.g. "REFUND", "PROMOTION", "WELCOME_BONUS"
  amount Int // cents

  expiresAt DateTime? // Optional expiration date

  createdAt DateTime @default(now())

  @@index([userId])
  @@index([sellerId])
}

//////////////////////////////////////
// PAGE VIEW TRACKING
//////////////////////////////////////

model PageView {
  id        String   @id @default(cuid())
  date      DateTime @default(now()) @db.Date // Date of the view (date only, no time)
  path      String // Page path (e.g., "/", "/listings/123", "/marketplace")
  userAgent String? // User agent string
  ipAddress String? // IP address (for analytics, may be anonymized)
  userId    String? // Optional: logged-in user ID
  createdAt DateTime @default(now()) // Timestamp of when the view was recorded

  @@index([date])
  @@index([path])
  @@index([userId])
  @@index([date, path])
}

//////////////////////////////////////
// USER PREFERENCES & ACTIVITY
//////////////////////////////////////

model SavedSearch {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  name        String? // Optional name for the search
  searchQuery String? // Search term
  category    String? // Category filter
  minPrice    Int? // Min price in cents
  maxPrice    Int? // Max price in cents
  productType String? // DIGITAL or PHYSICAL
  sortBy      String? // Sort option
  filters     String? // JSON string of additional filters
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
}

model RecentlyViewed {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  listingId String
  listing   Listing  @relation(fields: [listingId], references: [id])
  viewedAt  DateTime @default(now())

  @@unique([userId, listingId])
  @@index([userId, viewedAt])
  @@index([listingId])
}

model ProductComparison {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  listingId String
  listing   Listing  @relation(fields: [listingId], references: [id])
  addedAt   DateTime @default(now())

  @@unique([userId, listingId])
  @@index([userId])
}

model ListingView {
  id        String   @id @default(cuid())
  listingId String
  listing   Listing  @relation(fields: [listingId], references: [id])
  userId    String? // Optional: logged-in user
  user      User?    @relation(fields: [userId], references: [id])
  viewedAt  DateTime @default(now())
  duration  Int? // View duration in seconds (optional)

  @@index([listingId, viewedAt])
  @@index([userId])
  @@index([viewedAt])
}

model PriceAlert {
  id               String    @id @default(cuid())
  userId           String
  user             User      @relation(fields: [userId], references: [id])
  listingId        String
  listing          Listing   @relation(fields: [listingId], references: [id])
  targetPriceCents Int // Price to alert at
  isActive         Boolean   @default(true)
  notifiedAt       DateTime?
  createdAt        DateTime  @default(now())

  @@unique([userId, listingId])
  @@index([userId, isActive])
  @@index([listingId])
}

model ListingFavorite {
  id        String   @id @default(cuid())
  userId    String
  user      User     @relation(fields: [userId], references: [id])
  listingId String
  listing   Listing  @relation(fields: [listingId], references: [id])
  createdAt DateTime @default(now())

  @@unique([userId, listingId])
  @@index([userId])
  @@index([listingId])
}

model Collection {
  id          String   @id @default(cuid())
  userId      String
  user        User     @relation(fields: [userId], references: [id])
  name        String
  description String?
  isPublic    Boolean  @default(false)
  listingIds  String[] // Array of listing IDs
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@index([userId])
  @@index([isPublic])
}
